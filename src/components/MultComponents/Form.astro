---
import AmountField from "@/components/UniqueComponents/AmountField.astro";
import FormField from "@/components/UniqueComponents/FormField.astro";
import ErrorLabel from "@/components/UniqueComponents/ErrorLabel.astro";

import validateFormData from "@/lib/api";

import EthereumIcon from "@/components/icons/Ethereum.astro";

let error_payee = false;
let error_agent = false;
let error_amount = false;

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const payee = formData.get("payee_address") as string;
  const agent = formData.get("agent_address") as string;
  const amount_float = parseFloat(formData.get("amount") as string) as number;
  const { payee_address, agent_address, amount, error } = validateFormData(
    payee,
    agent,
    amount_float
  );
  ({ error_payee, error_agent, error_amount } = error);
}
---

<form method="post" class="flex flex-col items-center max-w-96 min-w-full">
  <FormField id="payee_address" placeholder="0xa9fdef78..." type="text">
    Dirección del receptor
  </FormField>
  {error_payee && <ErrorLabel>Direccion del receptor</ErrorLabel>}
  <FormField id="agent_address" placeholder="0xba0e3c9a..." type="text">
    Dirección del agente
  </FormField>
  {error_agent && <ErrorLabel>Direccion del agente</ErrorLabel>}

  <AmountField id="amount" placeholder="10.00" type="text">
    Cantidad
  </AmountField>
  {error_amount && <ErrorLabel>Importe</ErrorLabel>}

  <button
    type="submit"
    class="font-medium rounded-lg text-sm px-5 py-2.5 text-center items-center flex w-full max-w-96 justify-center mt-10 text-light dark:text-light hover:scale-105 transition-transform hover:text-black dark:hover:text-black bg-yellow-400 dark:bg-yellow-200 hover:bg-yellow-500"
  >
    <EthereumIcon class="size-4 text-purple-500" />
    <span class="ms-1">Paga con Ethereum</span>
  </button>
</form>
